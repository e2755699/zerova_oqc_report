# æª”æ¡ˆæ¶æ§‹é‡æ§‹ TODO List

## ğŸ“‹ æ¦‚è¿°

æ­¤æ–‡ä»¶è¨˜éŒ„æœªä¾†éœ€è¦é‡æ§‹çš„æª”æ¡ˆæ¶æ§‹å’Œä»£ç¢¼æ”¹é€²é …ç›®ã€‚

---

## ğŸ”´ é«˜å„ªå…ˆç´š

### 1. SharePoint è·¯å¾‘ç®¡ç†é‡æ§‹

**æª”æ¡ˆ**: `lib/src/repo/sharepoint_uploader.dart`

**å•é¡Œ**:
- `"Jackalope"` å­—ä¸²ç¡¬ç·¨ç¢¼åœ¨å¤šè™•ï¼ˆ29+ è™•ï¼‰
- è·¯å¾‘æ§‹å»ºé‚è¼¯åˆ†æ•£åœ¨å„å€‹æ–¹æ³•ä¸­
- æœ¬åœ°è·¯å¾‘åˆ° SharePoint è·¯å¾‘çš„è½‰æ›é‚è¼¯é‡è¤‡

**é‡æ§‹å»ºè­°**:
- [ ] å»ºç«‹ `SharePointPathBuilder` é¡åˆ¥çµ±ä¸€ç®¡ç†è·¯å¾‘æ§‹å»º
- [ ] å°‡ `"Jackalope"` æå–ç‚ºå¸¸æ•¸æˆ–é…ç½®
- [ ] å»ºç«‹è·¯å¾‘å¸¸æ•¸é¡åˆ¥ï¼ˆå¦‚ `SharePointPaths`ï¼‰å®šç¾©æ‰€æœ‰è·¯å¾‘æ¨¡æ¿
- [ ] çµ±ä¸€æœ¬åœ°è·¯å¾‘åˆ° SharePoint è·¯å¾‘çš„è½‰æ›é‚è¼¯
- [ ] å°‡ `_buildSharePointPath()` æ–¹æ³•ç§»åˆ°å°ˆé–€çš„è·¯å¾‘ç®¡ç†é¡åˆ¥

**é æœŸçµæ§‹**:
```dart
class SharePointPathBuilder {
  static const String rootPath = "Jackalope";
  
  static String buildPath(String category, {String? model, String? sn}) {
    // çµ±ä¸€çš„è·¯å¾‘æ§‹å»ºé‚è¼¯
  }
  
  static String convertLocalToSharePoint(String localPath) {
    // æœ¬åœ°è·¯å¾‘è½‰æ›é‚è¼¯
  }
}
```

---

### 2. SharePointUploader é¡åˆ¥æ‹†åˆ†

**æª”æ¡ˆ**: `lib/src/repo/sharepoint_uploader.dart` (1595 è¡Œ)

**å•é¡Œ**:
- å–®ä¸€é¡åˆ¥éå¤§ï¼Œè·è²¬éå¤š
- åŒ…å«ä¸Šå‚³ã€ä¸‹è¼‰ã€åˆªé™¤ã€æˆæ¬Šç­‰å¤šç¨®åŠŸèƒ½
- é›£ä»¥æ¸¬è©¦å’Œç¶­è­·

**é‡æ§‹å»ºè­°**:
- [ ] æ‹†åˆ†ç‚ºå¤šå€‹å°ˆé–€çš„é¡åˆ¥ï¼š
  - `SharePointAuthService` - OAuth æˆæ¬Šç›¸é—œ
  - `SharePointUploadService` - ä¸Šå‚³åŠŸèƒ½
  - `SharePointDownloadService` - ä¸‹è¼‰åŠŸèƒ½
  - `SharePointDeleteService` - åˆªé™¤åŠŸèƒ½
  - `SharePointPathConverter` - è·¯å¾‘è½‰æ›
- [ ] ä½¿ç”¨ä¾è³´æ³¨å…¥æ¨¡å¼
- [ ] å»ºç«‹çµ±ä¸€çš„ `SharePointClient` ä»‹é¢

**é æœŸçµæ§‹**:
```
lib/src/repo/sharepoint/
â”œâ”€â”€ sharepoint_client.dart          # åŸºç¤å®¢æˆ¶ç«¯
â”œâ”€â”€ sharepoint_auth_service.dart    # æˆæ¬Šæœå‹™
â”œâ”€â”€ sharepoint_upload_service.dart   # ä¸Šå‚³æœå‹™
â”œâ”€â”€ sharepoint_download_service.dart # ä¸‹è¼‰æœå‹™
â”œâ”€â”€ sharepoint_delete_service.dart   # åˆªé™¤æœå‹™
â”œâ”€â”€ sharepoint_path_builder.dart     # è·¯å¾‘æ§‹å»º
â””â”€â”€ models/
    â””â”€â”€ sharepoint_file.dart         # æª”æ¡ˆæ¨¡å‹
```

---

### 3. éŒ¯èª¤è™•ç†å’Œé‡è©¦é‚è¼¯çµ±ä¸€

**æª”æ¡ˆ**: `lib/src/repo/sharepoint_uploader.dart`

**å•é¡Œ**:
- é‡è©¦é‚è¼¯åœ¨å¤šè™•é‡è¤‡ï¼ˆä¸Šå‚³ã€ä¸‹è¼‰éƒ½æœ‰é¡ä¼¼çš„é‡è©¦æ©Ÿåˆ¶ï¼‰
- éŒ¯èª¤è™•ç†ä¸ä¸€è‡´
- ç¼ºå°‘çµ±ä¸€çš„éŒ¯èª¤é¡å‹å®šç¾©

**é‡æ§‹å»ºè­°**:
- [ ] å»ºç«‹ `RetryHandler` é¡åˆ¥çµ±ä¸€è™•ç†é‡è©¦é‚è¼¯
- [ ] å»ºç«‹ `SharePointException` éŒ¯èª¤é¡å‹éšå±¤
- [ ] çµ±ä¸€éŒ¯èª¤è™•ç†å’Œæ—¥èªŒè¨˜éŒ„
- [ ] ä½¿ç”¨ç­–ç•¥æ¨¡å¼è™•ç†ä¸åŒçš„é‡è©¦ç­–ç•¥

**é æœŸçµæ§‹**:
```dart
class RetryHandler {
  static Future<T> retry<T>({
    required Future<T> Function() operation,
    int maxAttempts = 3,
    Duration delay = const Duration(seconds: 2),
  }) async {
    // çµ±ä¸€çš„é‡è©¦é‚è¼¯
  }
}

class SharePointException implements Exception {
  final String message;
  final int? statusCode;
  // ...
}
```

---

## ğŸŸ¡ ä¸­å„ªå…ˆç´š

### 4. è·¯å¾‘å¸¸æ•¸å’Œé…ç½®é›†ä¸­ç®¡ç†

**æª”æ¡ˆ**: `lib/src/repo/sharepoint_uploader.dart`

**å•é¡Œ**:
- è·¯å¾‘å­—ä¸²ï¼ˆå¦‚ "å¤–è§€åƒè€ƒç…§ç‰‡"ã€"é…ä»¶åŒ…åƒè€ƒç…§ç‰‡"ï¼‰ç¡¬ç·¨ç¢¼åœ¨å¤šè™•
- æœ¬åœ°è·¯å¾‘çµæ§‹ï¼ˆå¦‚ "Compare Pictures"ï¼‰èˆ‡ SharePoint è·¯å¾‘çš„å°æ‡‰é—œä¿‚åˆ†æ•£

**é‡æ§‹å»ºè­°**:
- [ ] å»ºç«‹ `SharePointPathConstants` é¡åˆ¥å®šç¾©æ‰€æœ‰è·¯å¾‘å¸¸æ•¸
- [ ] å»ºç«‹è·¯å¾‘æ˜ å°„è¡¨ï¼ˆæœ¬åœ°è·¯å¾‘ â†” SharePoint è·¯å¾‘ï¼‰
- [ ] å°‡è·¯å¾‘é…ç½®åŒ–ï¼Œæ”¯æ´æœªä¾†æ“´å±•

**é æœŸçµæ§‹**:
```dart
class SharePointPathConstants {
  // SharePoint è·¯å¾‘
  static const String appearancePhotos = "å¤–è§€åƒè€ƒç…§ç‰‡";
  static const String packagePhotos = "é…ä»¶åŒ…åƒè€ƒç…§ç‰‡";
  static const String photos = "Photos";
  static const String oqcReport = "OQC Report";
  
  // æœ¬åœ°è·¯å¾‘
  static const String comparePictures = "Compare Pictures";
  static const String comparePackagePictures = "Compare Package Pictures";
  
  // è·¯å¾‘æ˜ å°„
  static const Map<String, String> localToSharePoint = {
    comparePictures: appearancePhotos,
    comparePackagePictures: packagePhotos,
  };
}
```

---

### 5. æª”æ¡ˆæ“ä½œé‚è¼¯æŠ½å–

**æª”æ¡ˆ**: `lib/src/repo/sharepoint_uploader.dart`

**å•é¡Œ**:
- ä¸Šå‚³ã€ä¸‹è¼‰ã€åˆªé™¤çš„æª”æ¡ˆæ“ä½œé‚è¼¯æœ‰é‡è¤‡æ¨¡å¼
- æª”æ¡ˆåˆ—è¡¨ç²å–ã€é€²åº¦è¿½è¹¤é‚è¼¯åˆ†æ•£

**é‡æ§‹å»ºè­°**:
- [ ] å»ºç«‹ `FileOperation` æŠ½è±¡é¡åˆ¥
- [ ] å»ºç«‹ `UploadOperation`ã€`DownloadOperation`ã€`DeleteOperation` å¯¦ä½œ
- [ ] çµ±ä¸€é€²åº¦è¿½è¹¤æ©Ÿåˆ¶
- [ ] å»ºç«‹æª”æ¡ˆæ“ä½œä½‡åˆ—ç®¡ç†

---

### 6. é…ç½®ç®¡ç†æ”¹é€²

**æª”æ¡ˆ**: `lib/src/config/config_manager.dart`, `lib/src/repo/sharepoint_uploader.dart`

**å•é¡Œ**:
- `SharePointUploader` ç›´æ¥å¾ `ConfigManager` è®€å–é…ç½®
- é…ç½®é©—è­‰é‚è¼¯åˆ†æ•£
- ç¼ºå°‘é…ç½®çš„é è¨­å€¼å’Œé©—è­‰

**é‡æ§‹å»ºè­°**:
- [ ] å»ºç«‹ `SharePointConfig` é¡åˆ¥å°è£ SharePoint ç›¸é—œé…ç½®
- [ ] åŠ å…¥é…ç½®é©—è­‰é‚è¼¯
- [ ] æ”¯æ´é…ç½®çš„ç†±é‡è¼‰ï¼ˆå¦‚æœéœ€è¦çš„è©±ï¼‰
- [ ] å°‡é…ç½®æ³¨å…¥åˆ°æœå‹™é¡åˆ¥ä¸­

---

## ğŸŸ¢ ä½å„ªå…ˆç´š

### 7. æ¸¬è©¦è¦†è“‹ç‡æå‡

**å•é¡Œ**:
- ç¼ºå°‘å–®å…ƒæ¸¬è©¦
- ç¼ºå°‘æ•´åˆæ¸¬è©¦
- é›£ä»¥æ¸¬è©¦å› ç‚ºä»£ç¢¼è€¦åˆåº¦é«˜

**é‡æ§‹å»ºè­°**:
- [ ] é‡æ§‹å¾Œç‚ºæ¯å€‹æœå‹™é¡åˆ¥ç·¨å¯«å–®å…ƒæ¸¬è©¦
- [ ] å»ºç«‹ Mock ç‰©ä»¶ç”¨æ–¼æ¸¬è©¦
- [ ] ç·¨å¯«æ•´åˆæ¸¬è©¦é©—è­‰ SharePoint æ“ä½œ
- [ ] ä½¿ç”¨æ¸¬è©¦é©…å‹•é–‹ç™¼ï¼ˆTDDï¼‰é€²è¡Œé‡æ§‹

---

### 8. æ—¥èªŒå’Œç›£æ§æ”¹é€²

**æª”æ¡ˆ**: `lib/src/repo/sharepoint_uploader.dart`

**å•é¡Œ**:
- ä½¿ç”¨ `print()` é€²è¡Œæ—¥èªŒè¨˜éŒ„ï¼Œä¸å¤ å°ˆæ¥­
- ç¼ºå°‘çµæ§‹åŒ–æ—¥èªŒ
- ç¼ºå°‘æ“ä½œç›£æ§å’ŒæŒ‡æ¨™æ”¶é›†

**é‡æ§‹å»ºè­°**:
- [ ] å¼•å…¥æ—¥èªŒåº«ï¼ˆå¦‚ `logger`ï¼‰
- [ ] å»ºç«‹çµæ§‹åŒ–æ—¥èªŒæ ¼å¼
- [ ] åŠ å…¥æ“ä½œæŒ‡æ¨™æ”¶é›†ï¼ˆä¸Šå‚³/ä¸‹è¼‰é€Ÿåº¦ã€æˆåŠŸç‡ç­‰ï¼‰
- [ ] å»ºç«‹æ—¥èªŒç´šåˆ¥ç®¡ç†

---

### 9. éåŒæ­¥æ“ä½œæ”¹é€²

**æª”æ¡ˆ**: `lib/src/repo/sharepoint_uploader.dart`

**å•é¡Œ**:
- éƒ¨åˆ†æ“ä½œä½¿ç”¨åŒæ­¥æ–¹æ³•ï¼ˆå¦‚ `readAsBytesSync()`ï¼‰
- ç¼ºå°‘ä¸¦ç™¼æ§åˆ¶
- å¤§æª”æ¡ˆæ“ä½œå¯èƒ½é˜»å¡

**é‡æ§‹å»ºè­°**:
- [ ] å°‡æ‰€æœ‰åŒæ­¥æ“ä½œæ”¹ç‚ºéåŒæ­¥
- [ ] åŠ å…¥ä¸¦ç™¼æ§åˆ¶ï¼ˆå¦‚ä½¿ç”¨ `Stream` è™•ç†å¤§é‡æª”æ¡ˆï¼‰
- [ ] å¯¦ä½œæª”æ¡ˆä¸Šå‚³/ä¸‹è¼‰çš„æµå¼è™•ç†
- [ ] åŠ å…¥æ“ä½œå–æ¶ˆæ©Ÿåˆ¶

---

### 10. ç¨‹å¼ç¢¼è¨»è§£å’Œæ–‡ä»¶æ”¹é€²

**å•é¡Œ**:
- éƒ¨åˆ†æ–¹æ³•ç¼ºå°‘æ–‡ä»¶è¨»è§£
- è¤‡é›œé‚è¼¯ç¼ºå°‘èªªæ˜
- ç¼ºå°‘ä½¿ç”¨ç¯„ä¾‹

**é‡æ§‹å»ºè­°**:
- [ ] ç‚ºæ‰€æœ‰å…¬é–‹æ–¹æ³•åŠ å…¥å®Œæ•´çš„æ–‡ä»¶è¨»è§£
- [ ] ç‚ºè¤‡é›œé‚è¼¯åŠ å…¥è¡Œå…§è¨»è§£
- [ ] å»ºç«‹ä½¿ç”¨ç¯„ä¾‹å’Œæœ€ä½³å¯¦è¸æ–‡ä»¶
- [ ] ä½¿ç”¨ Dart çš„ `@deprecated` æ¨™è¨˜èˆŠæ–¹æ³•

---

## ğŸ“ é‡æ§‹é †åºå»ºè­°

1. **ç¬¬ä¸€éšæ®µ**: è·¯å¾‘ç®¡ç†é‡æ§‹ï¼ˆé«˜å„ªå…ˆç´š #1ï¼‰
   - å½±éŸ¿ç¯„åœå°ï¼Œé¢¨éšªä½
   - ç‚ºå¾ŒçºŒé‡æ§‹æ‰“ä¸‹åŸºç¤

2. **ç¬¬äºŒéšæ®µ**: éŒ¯èª¤è™•ç†çµ±ä¸€ï¼ˆé«˜å„ªå…ˆç´š #3ï¼‰
   - æå‡ä»£ç¢¼å“è³ª
   - æ”¹å–„ä½¿ç”¨è€…é«”é©—

3. **ç¬¬ä¸‰éšæ®µ**: é¡åˆ¥æ‹†åˆ†ï¼ˆé«˜å„ªå…ˆç´š #2ï¼‰
   - éœ€è¦è¼ƒå¤šæ™‚é–“
   - å»ºè­°åˆ†æ‰¹æ¬¡é€²è¡Œï¼Œä¿æŒå‘å¾Œç›¸å®¹

4. **ç¬¬å››éšæ®µ**: å…¶ä»–æ”¹é€²é …ç›®
   - æ ¹æ“šå¯¦éš›éœ€æ±‚æ±ºå®šå„ªå…ˆé †åº

---

## ğŸ” ç›¸é—œæª”æ¡ˆ

- `lib/src/repo/sharepoint_uploader.dart` - ä¸»è¦é‡æ§‹ç›®æ¨™
- `lib/src/config/config_manager.dart` - é…ç½®ç®¡ç†
- `lib/src/config/flavor_config.dart` - Flavor é…ç½®
- `docs/sharepoint.md` - SharePoint ä½¿ç”¨æ–‡ä»¶
- `docs/SharePointGraphAPI.md` - Graph API æ–‡ä»¶

---

## ğŸ“Š ä»£ç¢¼çµ±è¨ˆ

**SharePointUploader é¡åˆ¥**:
- ç¸½è¡Œæ•¸: ~1595 è¡Œ
- `"Jackalope"` å‡ºç¾æ¬¡æ•¸: 29+ æ¬¡
- `print()` ä½¿ç”¨æ¬¡æ•¸: 50+ æ¬¡
- åŒæ­¥æª”æ¡ˆæ“ä½œ: å¤šè™•ä½¿ç”¨ `readAsBytesSync()`, `existsSync()`
- é‡è©¦é‚è¼¯é‡è¤‡: ä¸Šå‚³ã€ä¸‹è¼‰éƒ½æœ‰é¡ä¼¼çš„é‡è©¦æ©Ÿåˆ¶

**ä¸»è¦æ–¹æ³•æ•¸é‡**:
- ä¸Šå‚³ç›¸é—œ: ~8 å€‹æ–¹æ³•
- ä¸‹è¼‰ç›¸é—œ: ~6 å€‹æ–¹æ³•
- åˆªé™¤ç›¸é—œ: ~5 å€‹æ–¹æ³•
- æˆæ¬Šç›¸é—œ: ~2 å€‹æ–¹æ³•

---

## ğŸ“… æ›´æ–°è¨˜éŒ„

- 2025-01-XX: åˆå§‹å»ºç«‹ TODO list

---

## ğŸ’¡ æ³¨æ„äº‹é …

- é‡æ§‹æ™‚è¦ä¿æŒå‘å¾Œç›¸å®¹æ€§
- æ¯æ¬¡é‡æ§‹å¾Œè¦é€²è¡Œå®Œæ•´æ¸¬è©¦
- å»ºè­°ä½¿ç”¨ Git åˆ†æ”¯é€²è¡Œé‡æ§‹ï¼Œä¾¿æ–¼å›æ»¾
- é‡æ§‹å‰å…ˆèˆ‡åœ˜éšŠè¨è«–ï¼Œç¢ºä¿ç†è§£æ¥­å‹™é‚è¼¯

